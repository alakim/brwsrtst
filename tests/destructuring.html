<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<link rel="stylesheet" href="../lib/test.css"/>
<script src="../lib/jquery-3.1.1.min.js"></script>
<script src="../lib/html.js"></script>
<script>
$(function(){
	var errorMessages = [];
	
//////////////////////////////////////////////////////////////////////////////////////////////

	let [firstName, lastName] = 'Илья Кантор'.split(' ');
	
	if(!(firstName=='Илья' && lastName=='Кантор')){
		errorMessages.push('Error 1');
	}

	let [n1, n2, ...rest] = 'Юлий Цезарь Император Рима'.split(' ');
	if(!(
		n1=='Юлий' &&
		n2=='Цезарь' &&
		rest[0]=='Император' &&
		rest[1]=='Рима'
	)){
		errorMessages.push('Error 2');
	}

	let [x='a', y='b'] = [];
	if(!(x=='a' && y=='b')){
		errorMessages.push('Error 3');
	}

	let {x2, y:y2, z2=1} = {x2:22, y:11};
	if(!(x2==22 && y2==11 && z2==1))
		errorMessages.push('Error 4');

	let options = {
		size:{w:100, h:50},
		colors:['#f00', '#0a0'],
		baseUrl:'http://yandex.ru'
	};
	let {baseUrl:base, size:{w:width, h:height}, colors:[errorClr, successClr]} = options;
	if(!(
		base=='http://yandex.ru' &&
		width==100 && height==50 &&
		errorClr=='#f00' && successClr=='#0a0'
	)){errorMessages.push('Error 5');}
	
	
	let ddd = {x:5, y:2};
	let {dddx, dddy} = ddd;
	dddx = 11;
	dddy = 33;
	// Деструктуризация это не разновидность присваивания, 
	// а не назначение алиасов к полям структуры.
	// Данные простых типов в деструктуризованные переменные передаются по значению,
	// исходная структура остается неизменной.
	if(JSON.stringify(ddd)!='{"x":5,"y":2}') errorMessages.push('Error 6');
	
	
	let ooo = {o1:{x:2}, o2:{x:3}};
	let {o1, o2} = ooo;
	o1.x = 22;
	o2.x = 33;
	// Если в полях деструктуризуемой структуры лежат объекты,
	// они передаются по ссылке, изменения в этих объектах
	// отражаются на исходной структуре
	if(JSON.stringify(ooo)!='{"o1":{"x":22},"o2":{"x":33}}') errorMessages.push('Error 7');
	
	
	// Деструктуризация - хороший способ импорта функций из внешних библиотек
	// В strict mode запрещена конструкция 'with' из-за ее небезопасности.
	// Вместо 'with' можно использовать деструктуризацию, которая позволяет
	// явным образом объявить список импортируемых из библиотеки функций.
	let myLib = {
		f1:x=>x*2,
		f2:x=>x*x
	};
	(function(){
		let {f1, f2} = myLib;
		if(f1(2)!=4) errorMessages.push('Error 8.1');
		if(f2(2)!=4) errorMessages.push('Error 8.2');
	})();

//////////////////////////////////////////////////////////////////////////////////////////////

	if(errorMessages.length){
		$('body').addClass('error');
		$('body').append(Html.div(
			Html.apply(errorMessages, function(msg){
				return Html.p(msg);
			})
		));
	}
	else
		$('body').addClass('success');
});
</script>
</head>
<body>
	<p>Деструктуризация</p>
</body>
</html>

